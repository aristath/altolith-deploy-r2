(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,r=window.wp.hooks;class s{static ID="gitlab";static NAME=(0,t.__)("GitLab (Experimental)","aether-site-exporter-providers");static TYPE="git-hosting";static DESCRIPTION=(0,t.__)("Git-based file storage using GitLab repositories. Uses GitLab API for browser-based deployment.","aether-site-exporter-providers");static ICON="ðŸ¦Š";static DEPLOYMENT_TYPE="blueprint_bundle";static CONFIG_FIELDS=[{id:"personal_access_token",label:(0,t.__)("Personal Access Token","aether-site-exporter-providers"),type:"text",required:!0,sensitive:!0,help:(0,t.__)("GitLab Personal Access Token with api and write_repository scopes","aether-site-exporter-providers")},{id:"project_id",label:(0,t.__)("Project ID","aether-site-exporter-providers"),type:"text",required:!1,sensitive:!1,validation:{pattern:"^\\d+$",message:(0,t.__)("Project ID must be a numeric value","aether-site-exporter-providers")},help:(0,t.__)("GitLab project ID. Either project_id or namespace+project_path is required.","aether-site-exporter-providers")},{id:"namespace",label:(0,t.__)("Namespace","aether-site-exporter-providers"),type:"text",required:!1,sensitive:!1,help:(0,t.__)("GitLab namespace (username or group) for the repository","aether-site-exporter-providers")},{id:"project_path",label:(0,t.__)("Project Path","aether-site-exporter-providers"),type:"text",required:!1,sensitive:!1,help:(0,t.__)("Repository name/path within the namespace. Either project_id or namespace+project_path is required.","aether-site-exporter-providers")},{id:"branch",label:(0,t.__)("Branch","aether-site-exporter-providers"),type:"text",required:!1,sensitive:!1,default:"main",help:(0,t.__)("Git branch to push to","aether-site-exporter-providers")}]}const i=new Map,o=new class{register(e,t){if(!e||"string"!=typeof e)throw new Error("ProviderRegistry.register() requires a valid provider ID string");if(!t||"function"!=typeof t)throw new Error("ProviderRegistry.register() requires a provider class");if(!t.ID)throw new Error(`Provider ${e} must have static ID property`);if(!t.NAME)throw new Error(`Provider ${e} must have static NAME property`);i.set(e,t),(0,r.doAction)("aether.providers.registered",e,t)}get(e){return i.get(e)||null}getAll(){return Array.from(i.values())}getAllIds(){return Array.from(i.keys())}getByDeploymentType(e){return this.getAll().filter(t=>t.DEPLOYMENT_TYPE===e)}getDefault(){const e=this.getByDeploymentType("static_site");if(e.length>0)return e[0];const t=this.getAll();return t.length>0?t[0]:null}getForDeploymentType(e){const t=this.getByDeploymentType(e);return t.length>0?t[0]:null}has(e){return i.has(e)}count(){return i.size}parseInstanceId(e){if(!e||"string"!=typeof e)return null;const t=e.split(":",2);return 2===t.length&&t[0]&&t[1]?{provider_type:t[0],uuid:t[1]}:null}getProviderForInstance(e){const t=this.parseInstanceId(e);return t?this.get(t.provider_type):null}createInstanceId(e){return`${e}:${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}`}clear(){i.clear()}};(0,r.addAction)("aether.providers.register","aether/provider-registry",e=>{if(!e||"function"!=typeof e)return;const t=e.ID;t&&o.register(t,e)});let a=o;if("undefined"!=typeof window)if(window.aether=window.aether||{},window.aether.ProviderRegistry){const e=window.aether.ProviderRegistry;Array.from(i.values()).forEach(t=>{const r=t.ID;e.get(r)||e.register(r,t)}),a=e}else window.aether.ProviderRegistry=o;const n=a,c=window.wp.apiFetch;var p=e.n(c);const d=new Map;function h(e){return`${e.method||"GET"}:${e.path||""}:${e.data?JSON.stringify(e.data):""}`}const u=(e,t)=>{const r=h(e);if(d.has(r))return d.get(r);const s=t(e);return d.set(r,s),s.finally(()=>{d.delete(r)}),s},l=new Map,g={"/assets":6e5,"/settings":6e4,"/config":18e5,"/check-wporg":36e5};const w=(e,t)=>{if("GET"!==(e.method||"GET"))return t(e);const r=h(e),s=l.get(r);if(function(e,t){if(!e)return!1;const r=function(e){for(const[t,r]of Object.entries(g))if(e&&e.includes(t))return r;return 3e5}(t);return 0!==r&&Date.now()-e.timestamp<r}(s,e.path))return Promise.resolve(s.response);const i=t(e);return i.then(e=>(l.set(r,{response:e,timestamp:Date.now()}),e)).catch(e=>{throw e}),i};!function(){const e="undefined"!=typeof window&&window.aetherData&&window.aetherData.restUrl?window.aetherData.restUrl:"/wp-json/",t="undefined"!=typeof window&&window.aetherData&&window.aetherData.nonce?window.aetherData.nonce:"";p().use(p().createRootURLMiddleware(e)),t&&function(e){p().use(p().createNonceMiddleware(e))}(t),p().use(w),p().use(u)}();const f=p();n.register(s.ID,s),(0,r.doAction)("aether.providers.register",s);const _="https://gitlab.com/api/v4";(0,r.addFilter)("aether.provider.test","aether/gitlab",(e,r)=>r?.startsWith("gitlab")?r.startsWith("gitlab-pages")?e:async()=>async function(e){const r=await async function(e){try{return(await f({path:`/aether/site-exporter/providers/${e}/config`,method:"GET"})).config||{}}catch(e){if("restProviderNotConfigured"===e.code||404===e.status)return{};throw e}}(e);if(!r.personal_access_token)return{success:!1,error:(0,t.__)("Personal access token is required","aether-site-exporter-providers")};try{const e=await fetch(`${_}/user`,{headers:{Authorization:`Bearer ${r.personal_access_token}`}});if(!e.ok)return{success:!1,error:(0,t.sprintf)(/* translators: %d: HTTP status code */ /* translators: %d: HTTP status code */
(0,t.__)("GitLab API returned status %d","aether-site-exporter-providers"),e.status)};const s=await e.json();return r.project_id&&!(await fetch(`${_}/projects/${r.project_id}`,{headers:{Authorization:`Bearer ${r.personal_access_token}`}})).ok?{success:!1,error:(0,t.__)("Cannot access GitLab project. Please verify project ID and token permissions.","aether-site-exporter-providers")}:{success:!0,message:(0,t.sprintf)(/* translators: %s: GitLab username */ /* translators: %s: GitLab username */
(0,t.__)("Successfully connected to GitLab as %s","aether-site-exporter-providers"),s.username||s.name)}}catch(e){return{success:!1,error:e.message||(0,t.__)("Failed to connect to GitLab API","aether-site-exporter-providers")}}}(r):e,10),(0,r.addFilter)("aether.provider.upload_strategy","aether/gitlab",(e,t)=>t?.startsWith("gitlab")&&!t.startsWith("gitlab-pages")?"git":e,10)})();