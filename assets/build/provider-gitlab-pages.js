(()=>{"use strict";var e={231:(e,t,r)=>{r.d(t,{ConfigStorage:()=>R});var n=r(455),o=r.n(n);const i=new Map;function s(e){return`${e.method||"GET"}:${e.path||""}:${e.data?JSON.stringify(e.data):""}`}const a=(e,t)=>{const r=s(e);if(i.has(r))return i.get(r);const n=t(e);return i.set(r,n),n.finally(()=>{i.delete(r)}),n},c=new Map,d={"/assets":6e5,"/settings":6e4};const l=(e,t)=>{if("GET"!==(e.method||"GET"))return t(e);const r=s(e),n=c.get(r);if(function(e,t){if(!e)return!1;const r=function(e){for(const[t,r]of Object.entries(d))if(e&&e.includes(t))return r;return 3e5}(t);return 0!==r&&Date.now()-e.timestamp<r}(n,e.path))return Promise.resolve(n.response);const o=t(e);return o.then(e=>(c.set(r,{response:e,timestamp:Date.now()}),e)).catch(e=>{throw e}),o};!function(){const e="undefined"!=typeof window&&window.aetherData&&window.aetherData.restUrl?window.aetherData.restUrl:"/wp-json/aether/site-exporter/",t="undefined"!=typeof window&&window.aetherData&&window.aetherData.nonce?window.aetherData.nonce:"";o().use(o().createRootURLMiddleware(e)),t&&function(e){o().use(o().createNonceMiddleware(e))}(t),o().use(l),o().use(a)}();const u=o();var p=r(619);const h=(e,t)=>t.some(t=>e instanceof t);let g,f;const y=new WeakMap,w=new WeakMap,m=new WeakMap;let b={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return y.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function _(e){b=e(b)}function v(e){return"function"==typeof e?(t=e,(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(x(this),e),I(this.request)}:function(...e){return I(t.apply(x(this),e))}):(e instanceof IDBTransaction&&function(e){if(y.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});y.set(e,t)}(e),h(e,g||(g=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,b):e);var t}function I(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(I(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)});return m.set(t,e),t}(e);if(w.has(e))return w.get(e);const t=v(e);return t!==e&&(w.set(e,t),m.set(t,e)),t}const x=e=>m.get(e),D=["get","getKey","getAll","getAllKeys","count"],C=["put","add","delete","clear"],P=new Map;function A(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(P.get(t))return P.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=C.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!D.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return n&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),o&&i.done]))[0]};return P.set(t,i),i}_(e=>({...e,get:(t,r,n)=>A(t,r)||e.get(t,r,n),has:(t,r)=>!!A(t,r)||e.has(t,r)}));const E=["continue","continuePrimaryKey","advance"],k={},S=new WeakMap,B=new WeakMap,j={get(e,t){if(!E.includes(t))return e[t];let r=k[t];return r||(r=k[t]=function(...e){S.set(this,B.get(this)[t](...e))}),r}};async function*$(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,j);for(B.set(r,t),m.set(r,x(t));t;)yield r,t=await(S.get(r)||t.continue()),S.delete(r)}function L(e,t){return t===Symbol.asyncIterator&&h(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&h(e,[IDBIndex,IDBObjectStore])}_(e=>({...e,get:(t,r,n)=>L(t,r)?$:e.get(t,r,n),has:(t,r)=>L(t,r)||e.has(t,r)}));const T=new Map,F={dbName:"aether-site-exporter",version:1,stores:{cache:{keyPath:"key",indexes:[{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"type",keyPath:"type",unique:!1}]}}};const G=class{constructor(e,t=F){this.storeName=e,this.config=t,this.db=null,this.keyPath=t.stores?.[e]?.keyPath||F.stores.cache.keyPath}async ensureDatabase(){return this.db||(this.db=await async function(e=F){const t=`${e.dbName}_v${e.version}`;if(T.has(t))return T.get(t);try{const r=await function(e,t,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=I(s);return n&&s.addEventListener("upgradeneeded",e=>{n(I(s.result),e.oldVersion,e.newVersion,I(s.transaction),e)}),r&&s.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}(e.dbName,e.version,{upgrade(t){Object.entries(e.stores).forEach(([e,r])=>{t.objectStoreNames.contains(e)&&t.deleteObjectStore(e);const n=t.createObjectStore(e,{keyPath:r.keyPath,autoIncrement:r.autoIncrement||!1});r.indexes&&r.indexes.forEach(e=>{n.createIndex(e.name,e.keyPath,{unique:e.unique||!1})})})}});return T.set(t,r),r}catch(e){throw new Error(`Failed to open IndexedDB: ${e.message||"Unknown error"}`)}}(this.config)),this.db}async get(e){try{const t=await this.ensureDatabase();return await t.get(this.storeName,e)||null}catch(t){return console.error(`[IndexedDB] Error getting key "${e}":`,t),null}}async getAll(e=void 0){try{const t=await this.ensureDatabase();return await t.getAll(this.storeName,void 0,e)||[]}catch(e){return console.error("[IndexedDB] Error getting all values:",e),[]}}async getAllKeys(){try{const e=await this.ensureDatabase();return await e.getAllKeys(this.storeName)||[]}catch(e){return console.error("[IndexedDB] Error getting all keys:",e),[]}}async set(e,t,r={}){try{const n=await this.ensureDatabase(),o="object"==typeof t&&null!==t?{...t}:{value:t},i={[this.keyPath]:e,...o,timestamp:Date.now(),...r};return await n.put(this.storeName,i),!0}catch(t){return("QuotaExceededError"===t.name||t.message?.includes("quota"))&&console.warn("[IndexedDB] Storage quota exceeded. Consider cleaning up old data."),console.error(`[IndexedDB] Error setting key "${e}":`,t),!1}}async delete(e){try{const t=await this.ensureDatabase();return await t.delete(this.storeName,e),!0}catch(t){return console.error(`[IndexedDB] Error deleting key "${e}":`,t),!1}}async clear(){try{const e=await this.ensureDatabase();return await e.clear(this.storeName),!0}catch(e){return console.error("[IndexedDB] Error clearing store:",e),!1}}async count(){try{const e=await this.ensureDatabase();return await e.count(this.storeName)||0}catch(e){return console.error("[IndexedDB] Error counting items:",e),0}}async getByIndex(e,t){try{const r=await this.ensureDatabase();return await r.getAllFromIndex(this.storeName,e,t)||[]}catch(t){return console.error(`[IndexedDB] Error getting by index "${e}":`,t),[]}}async deleteOlderThan(e){try{const t=await this.ensureDatabase(),r=Date.now()-e,n=t.transaction(this.storeName,"readwrite"),o=n.objectStore(this.storeName).index("timestamp");let i=0,s=await o.openCursor(IDBKeyRange.upperBound(r));for(;s;)await s.delete(),i++,s=await s.continue();return await n.done,i}catch(e){return console.error("[IndexedDB] Error deleting old items:",e),0}}async getStorageEstimate(){if(navigator.storage&&navigator.storage.estimate)try{const e=await navigator.storage.estimate();return{quota:e.quota,usage:e.usage,percentUsed:e.quota>0?e.usage/e.quota*100:0}}catch(e){console.error("[IndexedDB] Error getting storage estimate:",e)}return{quota:null,usage:null,percentUsed:null}}},N={dbName:"aether-provider-configs",version:1,stores:{configs:{keyPath:"cacheKey",indexes:[{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"providerId",keyPath:"providerId",unique:!1}]}}};let q=null;function U(){return q||(q=new G("configs",N)),q}class R{providerId;cacheKey;store;constructor(e){if(!e||"string"!=typeof e)throw new Error("ConfigStorage requires a valid provider ID");this.providerId=e,this.cacheKey=`provider:${e}`,this.store=U()}async load(){const e=await this.getFromCache();if(null!==e)return e;try{let e=(await u({path:`/aether/site-exporter/providers/${this.providerId}/config`,method:"GET"})).config||{};return e=(0,p.applyFilters)("aether.storage.config.load",e,this.providerId),this.saveToCache(e),(0,p.doAction)("aether.storage.config.loaded",e,this.providerId),e}catch(e){if("restProviderNotConfigured"===e.code||404===e.status)return{};throw e}}async save(e){e=(0,p.applyFilters)("aether.storage.config.before_save",e,this.providerId);try{return await u({path:`/aether/site-exporter/providers/${this.providerId}/config`,method:"POST",data:{config:e}}),this.saveToCache(e),(0,p.doAction)("aether.storage.config.saved",e,this.providerId),!0}catch(e){throw e}}async delete(){(0,p.doAction)("aether.storage.config.before_delete",this.providerId);try{return await u({path:`/aether/site-exporter/providers/${this.providerId}/config`,method:"DELETE"}),this.clearCache(),(0,p.doAction)("aether.storage.config.deleted",this.providerId),!0}catch(e){throw e}}async getFromCache(){try{const e=await this.store.get(this.cacheKey);return e?Date.now()-e.timestamp>3e5?(await this.clearCache(),null):e.config:null}catch(e){return await this.clearCache(),null}}async saveToCache(e){try{await this.store.set(this.cacheKey,{config:e},{providerId:this.providerId})}catch(e){console.error(`[ConfigStorage] Failed to cache config for ${this.providerId}:`,e)}}async clearCache(){try{await this.store.delete(this.cacheKey)}catch(e){console.error(`[ConfigStorage] Failed to clear cache for ${this.providerId}:`,e)}}static async invalidateCache(e){const t=new R(e);await t.clearCache()}static async clearAllCaches(){try{const e=U();await e.clear()}catch(e){console.error("[ConfigStorage] Failed to clear all caches:",e)}}}},455:e=>{e.exports=window.wp.apiFetch},619:e=>{e.exports=window.wp.hooks}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=r(619);const o=window.wp.i18n,i="static_site",s="blueprint_bundle",a="edge_functions",c={[i]:(0,o.__)("Static Site","aether-site-exporter"),[s]:(0,o.__)("Blueprint Bundle","aether-site-exporter"),[a]:(0,o.__)("Edge Functions","aether-site-exporter")},d={[i]:(0,o.__)("Deploy static HTML/CSS/JS files for web hosting","aether-site-exporter"),[s]:(0,o.__)("Deploy WordPress Playground blueprint bundle (ZIP file)","aether-site-exporter"),[a]:(0,o.__)("Deploy serverless functions to edge computing platforms","aether-site-exporter")};async function l(e,t,r){if(t.required&&!e)return(0,o.sprintf)(/* translators: %s: Field label */ /* translators: %s: Field label */
(0,o.__)("%s is required.","aether-site-exporter"),t.label);if(!e)return null;if(t.validation){const n=t.validation;if(n.pattern&&!new RegExp(n.pattern).test(e))return n.message?n.message:(0,o.sprintf)(/* translators: %s: Field label */ /* translators: %s: Field label */
(0,o.__)("%s format is invalid.","aether-site-exporter"),t.label);if(void 0!==n.minLength&&e.length<n.minLength)return(0,o.sprintf)(/* translators: 1: Field label, 2: Minimum length */ /* translators: 1: Field label, 2: Minimum length */
(0,o.__)("%1$s must be at least %2$d characters.","aether-site-exporter"),t.label,n.minLength);if(void 0!==n.maxLength&&e.length>n.maxLength)return(0,o.sprintf)(/* translators: 1: Field label, 2: Maximum length */ /* translators: 1: Field label, 2: Maximum length */
(0,o.__)("%1$s must be no more than %2$d characters.","aether-site-exporter"),t.label,n.maxLength);if(n.callback&&"function"==typeof n.callback){const t=await n.callback(e,r);if("string"==typeof t)return t}}return null}function u(e,t){switch(t.type||"text"){case"password":case"text":case"textarea":default:return String(e).trim();case"email":return String(e).trim().toLowerCase();case"url":return String(e).trim().replace(/\/$/,"");case"checkbox":return Boolean(e);case"number":return Number(e)||0;case"select":return e;case"checkbox-group":return Array.isArray(e)?e:[]}}function p(e,t){return(t||[]).map(e=>e.value).includes(e)}function h(e,t){if(!Array.isArray(e))return[];const r=(t||[]).map(e=>e.value);return 0===r.length?e:e.filter(e=>r.includes(e))}class g{config={};registeredId=null;configStorage=null;constructor(e={},t=null){this.config=e,this.registeredId=t,this.initialize()}initialize(){}getId(){throw new Error("AbstractProvider.getId() must be implemented by subclass")}getName(){throw new Error("AbstractProvider.getName() must be implemented by subclass")}getType(){throw new Error("AbstractProvider.getType() must be implemented by subclass")}getDescription(){throw new Error("AbstractProvider.getDescription() must be implemented by subclass")}getIcon(){return"ðŸ“¦"}getSupportedDeploymentTypes(){return[]}getDeploymentTypesWithFilter(){const e=this.getSupportedDeploymentTypes();return(0,n.applyFilters)("aether.provider.supported_deployment_types",e,this.getId(),this)}supportsDeploymentType(e){return this.getDeploymentTypesWithFilter().includes(e)}getEnabledDeploymentTypes(){const e=this.config||{};return e.deployment_types&&Array.isArray(e.deployment_types)&&e.deployment_types.length>0?e.deployment_types:this.getSupportedDeploymentTypes()}isDeploymentTypeEnabled(e){return this.getEnabledDeploymentTypes().includes(e)}async getConfig(){return 0===Object.keys(this.config).length&&(this.config=await this.loadConfig()),(0,n.applyFilters)("aether.provider.config.get",this.config,this.getId())}async saveConfig(e){e=(0,n.applyFilters)("aether.provider.config.before_save",e,this.getId());const t=await this.validateConfig(e);if(Object.keys(t).length>0)throw new Error((0,o.sprintf)(/* translators: %s: JSON string of validation errors */ /* translators: %s: JSON string of validation errors */
(0,o.__)("Configuration validation failed: %s","aether-site-exporter"),JSON.stringify(t)));const r=await this.sanitizeConfig(e),i=await this.getConfigStorage(),s=await i.save(r);return s&&(this.config=r,(0,n.doAction)("aether.provider.config.saved",r,this.getId())),s}async deleteConfig(){(0,n.doAction)("aether.provider.config.before_delete",this.getId());const e=await this.getConfigStorage(),t=await e.delete();return t&&(this.config={},(0,n.doAction)("aether.provider.config.deleted",this.getId())),t}async isConfigured(){const e=await this.getConfig();return 0!==Object.keys(e).length&&function(e,t){for(const r of t)if(r.required&&!e[r.id])return!1;return!0}(e,this.getConfigFields())}async validateConfig(e){const t=await async function(e,t){const r={};for(const n of t){const t=n.id,o=e[t],i=await l(o,n,e);i&&(r[t]=i)}return r}(e,this.getConfigFields());return(0,n.applyFilters)("aether.provider.config.validate",t,e,this.getId())}async sanitizeConfig(e){const t=function(e,t){const r={};for(const n of t){const t=n.id;if(!(t in e))continue;const o=e[t],i=n.type||"text";"select"!==i?r[t]="checkbox-group"!==i?u(o,n):h(o,n.options):p(o,n.options)&&(r[t]=o)}return r}(e,this.getConfigFields());return(0,n.applyFilters)("aether.provider.config.sanitize",t,e,this.getId())}getConfigFields(){const e=[],t=function(e){const t=e.getSupportedDeploymentTypes();return t&&0!==t.length?{id:"deployment_types",type:"checkbox-group",label:(0,o.__)("Deployment Types","aether-site-exporter"),help:(0,o.__)("Select which types of deployments to use this provider for","aether-site-exporter"),required:!1,options:t.map(e=>({value:e,label:c[e]||e,description:d[e]||""})),defaultValue:t}:null}(this);t&&e.push(t);const r=this.getProviderSpecificConfigFields?.()||[];return e.push(...r),(0,n.applyFilters)("aether.provider.config_fields",e,this.getId(),this)}getProviderSpecificConfigFields(){return[]}async deploy(){return{success:!0,message:"No deployment needed for this provider."}}async getStatus(){const e=await this.isConfigured();return{configured:e,healthy:e}}getSettingsUrl(){return`admin.php?page=aether#/settings/provider/${this.getId()}`}getDocumentationUrl(){return`https://docs.aether.dev/providers/${this.getId()}`}getMetadata(){const e={id:this.getId(),name:this.getName(),type:this.getType(),description:this.getDescription(),icon:this.getIcon(),supportedDeploymentTypes:this.getDeploymentTypesWithFilter(),configFields:this.getConfigFields(),settingsUrl:this.getSettingsUrl(),documentationUrl:this.getDocumentationUrl()};return(0,n.applyFilters)("aether.provider.metadata",e,this.getId())}async getDeploymentUrl(){const e=await this.getConfig();let t="";return e.pages_url?t=e.pages_url:e.worker_endpoint?t=e.worker_endpoint:e.public_url&&(t=e.public_url),(0,n.applyFilters)("aether.provider.deployment_url",t,e,this.getId())}getUploadStrategy(){return"storage"}async uploadFile(e,t,r={}){throw new Error("AbstractProvider.uploadFile() must be implemented by subclass")}async loadConfig(){return(await this.getConfigStorage()).load()}async getConfigStorage(){if(!this.configStorage){const{ConfigStorage:e}=await Promise.resolve().then(r.bind(r,231));this.configStorage=new e(this.getId())}return this.configStorage}async getConfigValue(e,t=null){const r=await this.getConfig();return void 0!==r[e]?r[e]:t}async hasConfigValue(e){const t=await this.getConfig();return Boolean(t[e])}getFieldsById(e){const t=this.getConfigFields(),r={};return t.forEach(e=>{const t=e.id||e.name||"";t&&(r[t]=e)}),e.filter(e=>r[e]).map(e=>r[e])}renderSettings(e,t){return null}hasCustomSettings(){return this.renderSettings!==g.prototype.renderSettings}}class f extends g{getSupportedDeploymentTypes(){return[s,i]}experimental=!0;getName(){const e=this.getBaseName();return this.experimental?(0,o.sprintf)(/* translators: %s: Provider name */ /* translators: %s: Provider name */
(0,o.__)("%s (Experimental)","aether"),e):e}getBaseName(){throw new Error("AbstractGitProvider.getBaseName() must be implemented by subclass")}getType(){return"git-hosting"}getProviderSpecificConfigFields(){return[]}normalizeGitUrl(e){return e?e.endsWith(".git")?e:e+".git":""}async getGitProxyUrl(){const e=await this.getConfig();if(e.git_worker_url)return e.git_worker_url;try{const e=function(){const e=document.querySelector('meta[name="aether-rest-url"]');return e&&e.getAttribute("content")||"/wp-json/aether/site-exporter/"}(),t=document.querySelector('meta[name="aether-rest-nonce"]'),r=t?t.getAttribute("content"):"",n=await fetch(`${e}settings`,{headers:{"X-WP-Nonce":r}});if(n.ok){const e=await n.json(),t=e?.providers?.[e?.provider_types?.storage]?.worker_endpoint;if(t)return t}}catch(e){}return null}async getGitAuth(){return{username:(await this.getConfig()).personal_access_token||"",password:""}}async getGitRepositoryUrl(){throw new Error("AbstractGitProvider.getGitRepositoryUrl() must be implemented by subclass")}getApiBaseUrl(){throw new Error("AbstractGitProvider.getApiBaseUrl() must be implemented by subclass")}async testConnection(){throw new Error("AbstractGitProvider.testConnection() must be implemented by subclass")}async getGitConfig(){const e=await this.getConfig(),t=await this.getGitRepositoryUrl();return{config:{gitUrl:this.normalizeGitUrl(t),branch:e.branch||"main",personalAccessToken:e.personal_access_token||""}}}getUploadStrategy(){return"git"}}function y(){return"undefined"!=typeof window&&!0===window.aetherDebug}function w(...e){y()&&window.console&&window.console.log&&window.console.log("[Aether]",...e)}function m(...e){y()&&window.console&&window.console.warn&&window.console.warn("[Aether Warning]",...e)}const b={debug:w,error:function(...e){y()&&window.console&&window.console.error&&window.console.error("[Aether Error]",...e)},warn:m,info:function(...e){y()&&window.console&&window.console.info&&window.console.info("[Aether Info]",...e)},table:function(e){y()&&window.console&&window.console.table&&window.console.table(e)},time:function(e){y()&&window.console&&window.console.time&&window.console.time(`[Aether] ${e}`)},timeEnd:function(e){y()&&window.console&&window.console.timeEnd&&window.console.timeEnd(`[Aether] ${e}`)},group:function(e){y()&&window.console&&window.console.group&&window.console.group(`[Aether] ${e}`)},groupEnd:function(){y()&&window.console&&window.console.groupEnd&&window.console.groupEnd()},enable:function(){"undefined"!=typeof window&&(window.aetherDebug=!0,w("Debug mode enabled"))},disable:function(){"undefined"!=typeof window&&(window.aetherDebug=!1)},isEnabled:y};"undefined"!=typeof window&&(window.aetherDebug=window.aetherDebug||!1,window.aetherDebugUtil=b);class _ extends f{static ID="gitlab";getId(){return this.registeredId||_.ID}getBaseName(){return(0,o.__)("GitLab","aether")}getName(){return super.getName()}getDescription(){return(0,o.__)("Git-based file storage using GitLab repositories. Uses GitLab API and isomorphic-git for browser-based deployment.","aether")}getIcon(){return"ðŸ¦Š"}getProviderSpecificConfigFields(){return[{id:"personal_access_token",label:(0,o.__)("Personal Access Token","aether"),type:"text",required:!0,sensitive:!0,help:(0,o.__)("GitLab Personal Access Token with api and write_repository scopes","aether")},{id:"project_id",label:(0,o.__)("Project ID","aether"),type:"text",required:!1,sensitive:!1,validation:{pattern:"^\\d+$",message:(0,o.__)("Project ID must be a numeric value","aether")},help:(0,o.__)("GitLab project ID. Either project_id or namespace+project_path is required.","aether")},{id:"namespace",label:(0,o.__)("Namespace","aether"),type:"text",required:!1,sensitive:!1,help:(0,o.__)("GitLab namespace (username or group) for the repository","aether")},{id:"project_path",label:(0,o.__)("Project Path","aether"),type:"text",required:!1,sensitive:!1,help:(0,o.__)("Repository name/path within the namespace. Either project_id or namespace+project_path is required.","aether")},{id:"branch",label:(0,o.__)("Branch","aether"),type:"text",required:!1,sensitive:!1,default:"main",help:(0,o.__)("Git branch to push to","aether")}]}getApiBaseUrl(){return"https://gitlab.com/api/v4"}async getGitRepositoryUrl(){const e=await this.getConfig();if(e.namespace&&e.project_path)return`https://gitlab.com/${e.namespace}/${e.project_path}.git`;if(e.project_id){if(e.namespace){try{const t=this.getApiBaseUrl(),r=await fetch(`${t}/projects/${e.project_id}`,{headers:{Authorization:`Bearer ${e.personal_access_token}`}});if(r.ok){const e=await r.json();if(e.path_with_namespace)return`https://gitlab.com/${e.path_with_namespace}.git`}}catch(e){m("Failed to fetch project info from GitLab API:",e)}return`https://gitlab.com/${e.namespace}/${e.project_id}.git`}if(e.personal_access_token)try{const t=this.getApiBaseUrl(),r=await fetch(`${t}/projects/${e.project_id}`,{headers:{Authorization:`Bearer ${e.personal_access_token}`}});if(r.ok){const e=await r.json();if(e.path_with_namespace)return`https://gitlab.com/${e.path_with_namespace}.git`;if(e.web_url){const t=e.web_url.match(/https?:\/\/[^\/]+\/(.+)/);if(t)return`https://gitlab.com/${t[1]}.git`}}}catch(e){m("Failed to fetch project info from GitLab API:",e)}return`https://gitlab.com/projects/${e.project_id}.git`}throw new Error((0,o.__)("GitLab repository URL cannot be constructed. Please provide namespace and project_path, or project_id with personal_access_token.","aether"))}async testConnection(){const e=await this.getConfig();if(!e.personal_access_token)return{success:!1,error:(0,o.__)("Personal access token is required","aether")};try{const t=this.getApiBaseUrl(),r=await fetch(`${t}/user`,{headers:{Authorization:`Bearer ${e.personal_access_token}`}});if(!r.ok)return{success:!1,error:(0,o.sprintf)(/* translators: %d: HTTP status code */ /* translators: %d: HTTP status code */
(0,o.__)("GitLab API returned status %d","aether"),r.status)};const n=await r.json();return e.project_id&&!(await fetch(`${t}/projects/${e.project_id}`,{headers:{Authorization:`Bearer ${e.personal_access_token}`}})).ok?{success:!1,error:(0,o.__)("Cannot access GitLab project. Please verify project ID and token permissions.","aether")}:{success:!0,message:(0,o.sprintf)(/* translators: %s: GitLab username */ /* translators: %s: GitLab username */
(0,o.__)("Successfully connected to GitLab as %s","aether"),n.username||n.name)}}catch(e){return{success:!1,error:e.message||(0,o.__)("Failed to connect to GitLab API","aether")}}}}class v extends _{static ID="gitlab-pages";getSupportedDeploymentTypes(){return[i]}getId(){return this.registeredId||v.ID}getBaseName(){return(0,o.__)("GitLab Pages","aether")}getName(){return super.getName()}getType(){return"git-hosting"}getDescription(){return(0,o.__)("GitLab Pages static site hosting with automatic CI/CD pipelines. Uses GitLab API and isomorphic-git for browser-based deployment.","aether")}getIcon(){return"ðŸ¦Š"}getProviderSpecificConfigFields(){return[{id:"personal_access_token",label:(0,o.__)("Personal Access Token","aether"),type:"text",required:!0,sensitive:!0,help:(0,o.__)("GitLab Personal Access Token with api and write_repository scopes","aether")},{id:"project_id",label:(0,o.__)("Project ID","aether"),type:"text",required:!0,sensitive:!1,validation:{pattern:"^\\d+$",message:(0,o.__)("Project ID must be a numeric value","aether")}},{id:"namespace",label:(0,o.__)("Namespace","aether"),type:"text",required:!1,sensitive:!1,help:(0,o.__)("GitLab namespace (username or group) for the repository","aether")},{id:"project_path",label:(0,o.__)("Project Path","aether"),type:"text",required:!1,sensitive:!1,help:(0,o.__)("Repository name/path within the namespace","aether")},{id:"branch",label:(0,o.__)("Branch","aether"),type:"text",required:!1,sensitive:!1,default:"main",help:(0,o.__)("Git branch to push to","aether")},{id:"pages_enabled",label:(0,o.__)("GitLab Pages Enabled","aether"),type:"checkbox",required:!1,sensitive:!1,default:!0},{id:"pages_url",label:(0,o.__)("Pages URL","aether"),type:"url",required:!1,sensitive:!1,help:(0,o.__)("Custom GitLab Pages URL","aether")},{id:"custom_domain",label:(0,o.__)("Custom Domain","aether"),type:"url",required:!1,sensitive:!1},{id:"git_worker_url",label:(0,o.__)("Git Worker URL","aether"),type:"url",required:!1,sensitive:!1,isAdvanced:!0}]}async deploy(){return await this.isConfigured()?{success:!0,message:(0,o.__)("GitLab Pages deployment is automatic when files are pushed to the repository.","aether")}:{success:!1,message:(0,o.__)("Cannot deploy: provider is not configured.","aether")}}async getStatus(){const e=await super.getStatus(),t=await this.getConfig();return e.pages_enabled=Boolean(t.pages_enabled),e.hasCustomDomain=Boolean(t.custom_domain),e.supportsBrowserGit=Boolean(t.git_worker_url),e}}const I=new Map,x=new class{register(e,t){if(!e||"string"!=typeof e)throw new Error("ProviderRegistry.register() requires a valid provider ID string");if(!t||"object"!=typeof t)throw new Error("ProviderRegistry.register() requires a provider instance");if("function"!=typeof t.getId)throw new Error(`Provider ${e} must implement getId() method`);if("function"!=typeof t.getName)throw new Error(`Provider ${e} must implement getName() method`);I.set(e,t),(0,n.doAction)("aether.providers.registered",e,t)}get(e){return I.get(e)||null}getAll(){return Array.from(I.values())}getAllIds(){return Array.from(I.keys())}getByDeploymentType(e){return this.getAll().filter(t=>(t.getSupportedDeploymentTypes?.()||[]).includes(e))}getDefault(){const e=this.getByDeploymentType("static_site");if(e.length>0)return e[0];const t=this.getAll();return t.length>0?t[0]:null}getForDeploymentType(e){const t=this.getByDeploymentType(e);return t.length>0?t[0]:null}has(e){return I.has(e)}count(){return I.size}parseInstanceId(e){if(!e||"string"!=typeof e)return null;const t=e.split(":",2);return 2===t.length&&t[0]&&t[1]?{provider_type:t[0],uuid:t[1]}:null}getProviderForInstance(e){const t=this.parseInstanceId(e);return t?this.get(t.provider_type):null}createInstanceId(e){return`${e}:${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}`}clear(){I.clear()}};(0,n.addAction)("aether.providers.register","aether/provider-registry",e=>{if(!e||"object"!=typeof e)return;let t;if("function"==typeof e.getId)t=e.getId();else{if(!e.id)return;t=e.id}x.register(t,e)});let D=x;if("undefined"!=typeof window)if(window.aether=window.aether||{},window.aether.ProviderRegistry){const e=window.aether.ProviderRegistry;Array.from(I.values()).forEach(t=>{const r=t.getId();e.get(r)||e.register(r,t)}),D=e,console.log("ProviderRegistry: Using global registry instance,",e.getAll().length,"providers registered")}else window.aether.ProviderRegistry=x,console.log("ProviderRegistry: Created global registry instance");const C=D,P=new v;C.register(P.getId(),P),(0,n.doAction)("aether.providers.register",P),(0,n.addFilter)("aether.provider.test","aether/gitlab-pages",(e,t,r)=>"gitlab-pages"===t||t?.startsWith("gitlab-pages:")?async e=>P.testConnection(e||r):e,10)})();